<html>
<body>
	<textarea id="printContent"></textarea>
	<input type="submit" onclick="connectAndPrint()" value="Print"/>
	<P>Type text into box and click on submit button.
	<script>
	var device;
	function setup(device) {
		return device.open()
		.then(() => device.selectConfiguration(1))
		.then(() => device.claimInterface(0))
	}
	function print() {
		var string = document.getElementById("printContent").value + "\n";
		var encoder = new TextEncoder();
		var data = encoder.encode(string);
		device.transferOut(1, data)
		.catch(error => { console.log(error); })
	}
	
	function connectAndPrint1(){
		var device;

		navigator.usb.requestDevice({ filters: [{
				vendorId: 0x13FE,
				classCode: 0x08, // vendor-specific
				subclassCode: 0x06,
				protocolCode: 0x50
		}]})
		.then(selectedDevice => {
			device = selectedDevice;
			return device.open(); // Begin a session.
		})
		.then(() => device.selectConfiguration(1)) // Select configuration #1 for the device.
		.then(() => device.claimInterface(2)) // Request exclusive control over interface #2.
		.then(() => device.controlTransferOut({
			requestType: 'class',
			recipient: 'interface',
			request: 0x22,
			value: 0x01,
			index: 0x02})) // Ready to receive data
		.then(() => device.transferIn(5, 64)) // Waiting for 64 bytes of data from endpoint #5.
		.then(result => {
			let decoder = new TextDecoder();
			console.log('Received: ' + decoder.decode(result.data));
		})
		.catch(error => { console.log(error); });
	}
	
	
	function connectAndPrint() {
		  let device;
		  try {
			device =navigator.usb.requestDevice({ filters: [{
				vendorId: 0x154B,
				classCode: 0x08, // vendor-specific
				subclassCode: 0x06,
				protocolCode: 0x50
			}]});
			
			device.open()
      .then(() => device.selectConfiguration(1))
      .then(() => device.claimInterface(0));
			
			//device.transferOut(1, data);
			
			let receivedData = data.transferIn(1, 6);
			
		  } catch (err) {
			// No device was selected.
		  }

	}
	navigator.usb.getDevices()
	.then(devices => {
		if (devices.length > 0) {
			device = devices[0];
			return setup(device);
		}
	})
	.catch(error => { console.log(error); });
	</script>
</body>
</html>
